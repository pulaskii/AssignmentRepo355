<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Provider Portal</title>
    <style>
        .patient-list {
            height: 150px;
            overflow-y: auto;
            border: 1px solid #ccc;
            margin-top: 10px;
        }

        .patient-item {
            padding: 8px;
            cursor: pointer;
        }

        .patient-item.selected {
            background-color: #cce5ff;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Provider Portal</h1>

    <div>
        <button id="view_patients_button">View Patients</button>
    </div>

    <h3 id="patient_header" hidden>Patients:</h3>

    <div class="patient-list" id="patient_list" hidden></div>

    <div class="actions">
        <button id="view_button" hidden>View</button>
        <button id="edit_button" hidden>Edit</button>
        <button id="remove_button" hidden>Remove</button>
    </div>

    <br>

    <div>
        <button id="back_button" hidden>Back</button>
    </div>

    <script>
    const patients = new Set([
        { name: "Patient 1", email: "johndoe@test.com" },
        { name: "Patient 2", email: "johndoe@test.com" },
        { name: "Patient 3", email: "johndoe@test.com" },
        { name: "Patient 4", email: "johndoe@test.com" },
        { name: "Patient 5", email: "johndoe@test.com" },
        { name: "Patient 6", email: "johndoe@test.com" },
        { name: "Patient 7", email: "johndoe@test.com" },
        { name: "Patient 8", email: "johndoe@test.com" },
        { name: "Patient 9", email: "johndoe@test.com" },
        { name: "Patient 10", email: "johndoe@test.com" }
    ]);

    let selectedPatient = null;

    const view_patients_button = document.getElementById('view_patients_button');
    const view_button = document.getElementById('view_button');
    const edit_button = document.getElementById('edit_button');
    const remove_button = document.getElementById('remove_button');
    const patient_header = document.getElementById('patient_header');
    const patient_list = document.getElementById('patient_list');
    const back_button = document.getElementById('back_button');

    // Render patients dynamically
    function renderPatients() {
        patient_list.innerHTML = "";

        patients.forEach(patient => {
            const div = document.createElement("div");
            div.classList.add("patient-item");
            div.textContent = patient.name;

            div.addEventListener("click", () => {
                // If this patient is already selected, deselect
                if (selectedPatient === patient) {
                    selectedPatient = null;
                    div.classList.remove("selected");
                } else {
                    // Deselect all
                    document.querySelectorAll(".patient-item").forEach(item => {
                        item.classList.remove("selected");
                    });

                    // Select this one
                    selectedPatient = patient;
                    div.classList.add("selected");
                }
            });

            patient_list.appendChild(div);
        });
    }

    document.getElementById('edit_button').addEventListener('click', () => {
        if (!selectedPatient) {
            alert("Please select a patient before editing.");
            return;
        }

        window.location.href = `edit_record_page?email=${encodeURIComponent(selectedPatient.email)}`;
    });

    view_patients_button.addEventListener('click', () => {
        patient_list.hidden = false;
        patient_header.hidden = false;
        view_button.hidden = false;
        edit_button.hidden = false;
        remove_button.hidden = false;

        renderPatients(); // Populate the list

        view_patients_button.style.display = 'none';
        back_button.hidden = false;
    });

    back_button.addEventListener('click', () => {

      patient_list.hidden = true;
      patient_header.hidden = true;
      view_button.hidden = true;
      edit_button.hidden = true;
      remove_button.hidden = true;

      selectedPatient = null;

      view_patients_button.style.display = '';
      back_button.hidden = false;
    });

    // When returning from edit page, auto-open patient list
    window.addEventListener('load', () => {
        const params = new URLSearchParams(window.location.search);
        if (params.get('view') === 'patients') {
            patient_list.hidden = false;
            patient_header.hidden = false;
            view_button.hidden = false;
            edit_button.hidden = false;
            remove_button.hidden = false;

            renderPatients();
            view_patients_button.style.display = 'none';
            back_button.hidden = false;
        }
    });

    </script>

</body>
</html>